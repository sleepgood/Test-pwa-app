<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sound-Based Color Changer</title>
    <link rel="manifest" href="./manifest.json">
    <style>
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            color: white;
            text-align: center;
            background-color: black;
        }
        #message {
            font-size: 1.5em;
        }
    </style>
</head>
<body>
    <div id="message">Allow microphone access and make some noise!</div>

    <script>
        const message = document.getElementById('message');

        // Function to start listening to the microphone
        async function startAudioProcessing() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                message.innerText = "Microphone access granted. Make some noise!";
                
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const analyser = audioContext.createAnalyser();
                const microphone = audioContext.createMediaStreamSource(stream);
                microphone.connect(analyser);
                analyser.fftSize = 256;

                const dataArray = new Uint8Array(analyser.frequencyBinCount);

                function changeColor() {
                    analyser.getByteFrequencyData(dataArray);
                    let values = 0;
                    for (let i = 0; i < dataArray.length; i++) {
                        values += dataArray[i];
                    }

                    const average = values / dataArray.length;
                    const red = Math.min(255, Math.floor(average * 2));
                    const green = 255 - red;
                    const blue = 128;

                    document.body.style.backgroundColor = `rgb(${red}, ${green}, ${blue})`;
                    message.innerText = `Sound level: ${Math.floor(average)}`;
                    requestAnimationFrame(changeColor);
                }

                changeColor();
            } catch (error) {
                message.innerText = "Microphone access denied or not supported.";
                console.error("Microphone access error:", error);
            }
        }

        // Start audio processing
        startAudioProcessing();
    </script>
</body>
</html>